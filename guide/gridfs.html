<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>2.9. GridFS &mdash; Casbah (MongoDB + Scala Toolkit) Documentation 2.6.1 documentation</title>

    <link rel="shortcut icon" href="http://media.mongodb.org/favicon.ico" />
    <meta name="robots" content="index" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    
    
    <link rel="stylesheet" href="../_static/mongodb-docs.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.6.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
      <link rel="search" type="application/opensearchdescription+xml" href="http://docs.mongodb.org/osd.xml" title="MongoDB Help"/>
<link rel="top" title="Casbah (MongoDB + Scala Toolkit) Documentation 2.6.1 documentation" href="../index.html" />
<link rel="up" title="2. User Guide" href="index.html" />
<link rel="next" title="2.10. Serialisation" href="serialisation.html" />
<link rel="prev" title="2.8. Aggregation Framework" href="aggregation.html" />
<!-- Put the following javascript before the closing </head> tag. -->
<script>
  (function() {
    var cx = '017213726194841070573:WMX6838984';
    var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
    gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
        '//www.google.com/cse/cse.js?cx=' + cx;
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();
</script>
  </head>
  <body>
<div id="top-right">
        <div class="user-right">
                <ul id="header-menu-bar" class="ajs-menu-bar">
                <li class="normal"><a target="_blank" href="http://groups.google.com/group/mongodb-user">Forums</a></li>
                <li class="normal"><a target="_blank" href="http://blog.mongodb.org/">Blog</a></li>
                <li class="normal"><a href="http://www.mongodb.org/downloads">Download</a></li>
                <li class="normal"><a href="http://docs.mongodb.org/ecosystem/drivers/">Drivers</a></li>
                <li class="normal"><a href="http://www.10gen.com/events">Events</a></li>
                <li class="normal last"><a class="last" href="http://docs.mongodb.org/manual/meta/translation">Translations</a></li>
                </ul>
        </div>
</div>
<div id="header-db" class="spread">
        <div class="split">
                <div id="logo">
                        <div><a href="../index.html"><img class="logo" src="http://media.mongodb.org/logo-mongodb.png" alt="MongoDB Logo"/></a></div>
                </div>
        </div>

<div class="search-db"><gcse:searchbox></gcse:searchbox></div>
<div id="etp">
<ul>
<li><a href="https://github.com/mongodb/casbah/blob/master/src/sphinx/guide/gridfs.rst" target="_blank" title="Edit guide/gridfs.rst on github">Edit this Page</a></li>
<li><a href="http://github.com/mongodb/casbah" target="_blank" title="Fork the documentation on GitHub and contribute.">GitHub</a></li>
<li><a href="https://jira.mongodb.org/secure/CreateIssueDetails!init.jspa?pid=10380&issuetype=4&priority=4&summary=Comment+on%3a+%22guide/gridfs%2Etxt%22" target="_blank" title="Report a problem with guide/gridfs.txt on Jira">Report a problem</a></li>
</ul>
</div>
</div>  
    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            <div id="cse-results"><gcse:searchresults></gcse:searchresults></div>
            
  <div class="section" id="gridfs">
<h1>2.9. GridFS<a class="headerlink" href="#gridfs" title="Permalink to this headline">¶</a></h1>
<p><tt class="docutils literal"><span class="pre">GridFS</span></tt> is a specification for storing and retrieving files
that exceed the BSON-document <a class="reference external" href="http://docs.mongodb.org/manual/reference/limits/#BSONDocumentSize">size limit</a> of 16MB.</p>
<p>Instead of storing a file in a single document, GridFS divides a file
into parts, or chunks, <a class="footnote-reference" href="#chunk-disambiguation" id="id1">[1]</a> and stores each of
those chunks as a separate document. By default GridFS limits chunk
size to 256k. GridFS uses two collections to store files. One
collection stores the file chunks, and the other stores file metadata.</p>
<p>When you query a GridFS store for a file, the driver or client will
reassemble the chunks as needed. You can perform range queries on
files stored through GridFS.  You also can access information from
arbitrary sections of files, which allows you to &quot;skip&quot; into the
middle of a video or audio file.</p>
<p>GridFS is useful not only for storing files that exceed 16MB but also
for storing any files for which you want access without having to load
the entire file into memory. For more information on the indications
of GridFS, see <a class="reference external" href="http://docs.mongodb.org/manual/faq/developers/#faq-developers-when-to-use-gridfs">faq-developers-when-to-use-gridfs</a>.</p>
<table class="docutils footnote" frame="void" id="chunk-disambiguation" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>The use of the term <em>chunks</em> in the context
of GridFS is not related to the use of the term <em>chunks</em> in
the context of sharding.</td></tr>
</tbody>
</table>
<div class="section" id="using-gridfs-in-casbah">
<h2>2.9.1. Using GridFS in Casbah<a class="headerlink" href="#using-gridfs-in-casbah" title="Permalink to this headline">¶</a></h2>
<p>GridFS is a separate package in Casbah and to use it you must import it
explicitly.  See the <a class="reference external" href="http://mongodb.github.io/casbah/api/#com.mongodb.casbah.gridfs.package">full gridfs api docs</a> for
more information about the package.</p>
<p>Example use case:</p>
<div class="highlight-scala"><div class="highlight"><pre><span class="k">import</span> <span class="nn">java.io.FileInputStream</span>
<span class="k">import</span> <span class="nn">com.mongodb.casbah.Imports._</span>
<span class="k">import</span> <span class="nn">com.mongodb.casbah.gridfs.Imports._</span>

<span class="c1">// Connect to the database</span>
<span class="k">val</span> <span class="n">mongoClient</span> <span class="k">=</span> <span class="nc">MongoClient</span><span class="o">()(</span><span class="s">&quot;test&quot;</span><span class="o">)</span>

<span class="c1">// Pass the connection to the GridFS class</span>
<span class="k">val</span> <span class="n">gridfs</span> <span class="k">=</span> <span class="nc">GridFS</span><span class="o">(</span><span class="n">mongoClient</span><span class="o">)</span>

<span class="c1">// Save a file to GridFS</span>
<span class="k">val</span> <span class="n">logo</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">&quot;mongo.png&quot;</span><span class="o">)</span>
<span class="k">val</span> <span class="n">id</span> <span class="k">=</span> <span class="n">gridfs</span><span class="o">(</span><span class="n">logo</span><span class="o">)</span> <span class="o">{</span> <span class="n">f</span> <span class="k">=&gt;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">filename</span> <span class="k">=</span> <span class="s">&quot;mongodb_logo.png&quot;</span>
    <span class="n">f</span><span class="o">.</span><span class="n">contentType</span> <span class="k">=</span> <span class="s">&quot;image/png&quot;</span>
<span class="o">}</span>

<span class="c1">// Find a file in GridFS by its ObjectId</span>
<span class="k">val</span> <span class="n">myFile</span> <span class="k">=</span> <span class="n">gridfs</span><span class="o">.</span><span class="n">findOne</span><span class="o">(</span><span class="n">id</span><span class="o">.</span><span class="n">get</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">ObjectId</span><span class="o">])</span>

<span class="c1">// Or find a file in GridFS by its filename</span>
<span class="k">val</span> <span class="n">myFile</span> <span class="k">=</span> <span class="n">gridfs</span><span class="o">.</span><span class="n">findOne</span><span class="o">(</span><span class="s">&quot;mongodb_logo.png&quot;</span><span class="o">)</span>

<span class="c1">// Print all filenames stored in GridFS</span>
<span class="k">for</span> <span class="o">(</span><span class="n">f</span> <span class="k">&lt;-</span> <span class="n">gridfs</span><span class="o">)</span> <span class="n">println</span><span class="o">(</span><span class="n">f</span><span class="o">.</span><span class="n">filename</span><span class="o">)</span>
</pre></div>
</div>
<div class="section" id="joda-datetime">
<h3>2.9.1.1. Joda DateTime<a class="headerlink" href="#joda-datetime" title="Permalink to this headline">¶</a></h3>
<p>Due to hardcoding in the Java GridFS driver the Joda Time
serialization hooks break with GridFS.  It tries to explicitly cast
certain date fields as a <tt class="docutils literal"><span class="pre">java.util.Date</span></tt>.  To that
end, on all find ops we explicitly unload the Joda Time deserializers and
reload them when we're done (if they were loaded before we started).  This
allows GridFS to always work but <em>MAY</em> cause thread safety issues - e.g.
if you have another non-GridFS read happening at the same time in another
thread at the same time, it may fail to deserialize BSON Dates as Joda
DateTime - and blow up.  Be careful --- generally we don't recommend mixing
Joda Time and GridFS in the same JVM at the moment.</p>
</div>
</div>
</div>


<div id="btnv">
<ul id="btnvl">
<li id="btnvpr"><a href="aggregation.html" title="Previous Section: 2.8. Aggregation Framework">&lt; &nbsp; 2.8. Aggregation Framework</a></li>
<li id="btnvup"><a href="index.html" title="Parent Section: 2. User Guide" >&#47;&#92;&nbsp; 2. User Guide</a></li>
<li id="btnvnx"><a href="serialisation.html" title="Next Section: 2.10. Serialisation">2.10. Serialisation &nbsp;&gt;</a></li>
</ul>
</div>
</div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper"><h3><a href="../index.html">Casbah, Scala Driver</a>

<small><a href="../genindex.html">(Index)</a></small>

</h3>

<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">1. Tutorial: Using Casbah</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">2. User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="philosophy.html">2.1. Philosophy</a></li>
<li class="toctree-l2"><a class="reference internal" href="modules.html">2.2. Casbah Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html">2.3. Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation_alt.html">2.4. Alternative installation methods</a></li>
<li class="toctree-l2"><a class="reference internal" href="connecting.html">2.5. Connecting to MongoDB</a></li>
<li class="toctree-l2"><a class="reference internal" href="querying.html">2.6. Querying</a></li>
<li class="toctree-l2"><a class="reference internal" href="query_dsl.html">2.7. Query DSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="aggregation.html">2.8. Aggregation Framework</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">2.9. GridFS</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-gridfs-in-casbah">2.9.1. Using GridFS in Casbah</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#joda-datetime">2.9.1.1. Joda DateTime</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="serialisation.html">2.10. Serialisation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">3. Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../upgrade.html">4. Upgrade</a></li>
</ul>
<h3 style="padding-bottom: 1em;"><a href="http://mongodb.github.io/casbah/api/#com.mongodb.casbah.package">API Documentation</a></h3>

<h3>Formats</h3>
<ul class="this-page-menu">
<li><a href="http://mongodb.github.io/casbah/CasbahDocumentation.epub">ePub</a></li>
<li><a href="http://mongodb.github.io/casbah/CasbahDocumentation.pdf">PDF</a></li>
</ul>
<h3 style="padding-bottom: 1em;"><a href="http://www.mongodb.org/about/">MongoDB.org</a></h3>
<h3 style="padding-bottom: 1em;"><a href="http://docs.mongodb.org/manual/">MongoDB Manual</a></h3>
<h3 style="padding-bottom: 1em;"><a href="http://docs.mongodb.org/ecosystem/">MongoDB Ecosystem</a></h3>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    <p>
       &copy; <a href="">Copyright</a> 2010-2013 10gen, Inc. 
       MongoDB&reg;, Mongo&reg;, and the leaf logo are registered trademarks of 10gen, Inc.
    </p>
  </div><script type="text/javascript">
var _gaq = _gaq || [];
var pluginUrl = (('https:' == document.location.protocol) ? 'https://ssl.' : 'http://www.') + 'google-analytics.com/plugins/ga/inpage_linkid.js';
_gaq.push(['_require', 'inpage_linkid', pluginUrl]);
_gaq.push(['_setAccount', 'UA-7301842-13']);
_gaq.push(['_setDomainName', 'docs.mongodb.org']);
_gaq.push(['_trackPageview']);
(function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
        })();
</script>

<script type="text/javascript">
document.write(unescape("%3Cscript src='" + document.location.protocol + "//munchkin.marketo.net/munchkin.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script>try { mktoMunchkin("017-HGS-593"); } catch(e) {}</script><script type="text/javascript">
jQuery.ajax({
    url: "https://jira.mongodb.org/s/en_US-bxctp1/782/6/1.2.4/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?collectorId=298ba4e7",
    type: "get",
    cache: true,
    dataType: "script"
});
window.ATL_JQ_PAGE_PROPS =  {
"triggerFunction": function(showCollectorDialog) {
jQuery("#jirafeedback").click(function(e) {e.preventDefault();showCollectorDialog();});
jQuery("#jirafooter").click(function(e) {e.preventDefault();showCollectorDialog();});
}};
</script>
</body>
</html>